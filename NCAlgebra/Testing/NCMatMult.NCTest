<< NCSymmetric`
<< NCSelfAdjoint`
<< NCSimplifyRational`

Module[
  {k, test, a, b, c, d, e, f, g, h, i, K, u, v, w, x},

  NCTest[tpMat[{{1,2},{3,4}}], {{1,3},{2,4}}];

  SetNonCommutative[a, b, c, d, e, f, g, h, i, K, u, v, w, x];

  NCTest[MatMult[{{a, b},{c,d}}, 
                 {{u,v},{w,x}}], 
                {{a**u+b**w, a**v+b**x}, 
                 {c**u+d**w, c**v+d**x}}];

  mat = {{a,b,0},{tp[b],e,d},{0,tp[d],i}};
  NCTest[NCSimplifyRational[MatMult[NCInverse[mat], mat]],
         {{1,0,0},{0,1,0},{0,0,1}}];

  (* NCSymmetricQ *)

  expr = {{a + tp[a]}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], True];

  expr = {{a}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], False];

  expr = {{a+tp[a],b},{tp[b],c+tp[c]}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{tp[b],c+tp[c]}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{tp[b],1}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{b,1}};
  NCTest[NCSymmetricQ[expr, ExcludeVariables -> All], False];

  (* NCSymmetricQ[#, False] *)

  Quiet[

    expr = {{1,b},{b,1}};
    NCTest[NCSymmetricQ[expr], True];

    expr = {{a,b},{b,c}};
    NCTest[NCSymmetricQ[expr], True];

    expr = {{a,b},{tp[b],c}};
    NCTest[NCSymmetricQ[expr], True];

    expr = {{a,b},{tp[b],tp[a]}};
    NCTest[NCSymmetricQ[expr], False];

    ,
    NCSymmetricQ::SymmetricVariables
  ];

  (* NCSelfAdjointQ *)

  expr = {{a + aj[a]}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], True];

  expr = {{a}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], False];

  expr = {{a+aj[a],b},{aj[b],c+aj[c]}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{aj[b],c+aj[c]}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{aj[b],1}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], True];

  expr = {{1,b},{b,1}};
  NCTest[NCSelfAdjointQ[expr, ExcludeVariables -> All], False];

  (* NCSelfAdjointQ[#, False] *)

  Quiet[

    expr = {{1,b},{b,1}};
    NCTest[NCSelfAdjointQ[expr], True];

    expr = {{a,b},{b,c}};
    NCTest[NCSelfAdjointQ[expr], True];

    expr = {{a,b},{aj[b],c}};
    NCTest[NCSelfAdjointQ[expr], True];

    expr = {{a,b},{aj[b],aj[a]}};
    NCTest[NCSelfAdjointQ[expr], False];

    expr = {{a,b},{tp[b],c}};
    NCTest[NCSelfAdjointQ[expr], True];

    expr = {{a,b},{tp[b],tp[a]}};
    NCTest[NCSelfAdjointQ[expr], False];

    expr = {{1,b},{tp[b],1}};
    NCTest[NCSelfAdjointQ[expr], True];

    expr = {{b,b},{tp[b],1}};
    NCTest[NCSelfAdjointQ[expr], False];

    expr = {{b+tp[b],b},{tp[b],1}};
    NCTest[NCSelfAdjointQ[expr], True];

    ,
    {NCSelfAdjointQ::SelfAdjointVariables, NCSymmetricQ::SymmetricVariables}
  ];

];

(*
  mat = {{a,rt[1 - a ** tp[a]]}, {rt[1-tp[a]**a],-tp[a]}};
  NCTest[DilationHalmos[a], mat];

  NCTest[Cascade[{{a,b},{c,d}},K] ==
      a + b**K**inv[1 - d**K] **c];

  NCTest[Redheffer[{{a,b},{c,d}}] ==
      {{b**inv[c], a - b **inv[c]**inv[d]},
       {inv[d],-inv[c] ** inv[d]}}];
*)

