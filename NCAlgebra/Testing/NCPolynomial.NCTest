<< NCPolynomial`

Module[
   {k, test, exp, answer, vars, p,
   a,b,c,d,e,f,g,h,j,x,y,z,A,B,C},

   k = 1;
   test = "NCPolynomial";

   SetNonCommutative[a,b,c,d,e,f,g,h,j,x,y,z];
   SetCommutative[A,B,C];

   (* NCConsecutiveTerms *)
   vars = {x,y};
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[x,y,vars], True, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[a,x,vars], False, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[x,b,vars], False, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[a,b,vars], True, test, k++];

   NCTest[NCPolynomial`Private`NCConsecutiveTerms[tp[x],y,vars], True, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[x,tp[y],vars], True, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[tp[x],y,vars], True, test, k++];
   NCTest[NCPolynomial`Private`NCConsecutiveTerms[tp[x],tp[y],vars], True, test, k++];

   (* NCSplitMonomials *)
   exp = a**x**b;
   answer = {{1,a,x,b}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x}], answer, test, k++];

   exp = a**x**b**c;
   answer = {{1,a,x,b**c}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x}], answer, test, k++];

   exp = a**x**y**b;
   answer = {{1,a,x**y,b}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = a**x**y**b**c;
   answer = {{1,a,x**y,b**c}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = a**tp[x]**b;
   answer = {{1,a,tp[x],b}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x}], answer, test, k++];

   exp = a**tp[x]**y**b;
   answer = {{1,a,tp[x]**y,b}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = x;
   answer = {{1,1,x,1}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = a**x;
   answer = {{1,a,x,1}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = a**x**y**b**c**x**f**y;
   answer = {{1,a,x**y,b**c,x,f,y,1}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x,y}], answer, test, k++];

   exp = a**x**b+c**x**d;
   answer = {{1,a,x,b}, {1,c,x,d}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x}], answer, test, k++];

   exp = A a**x**b + B c**x**d;
   answer = {{A,a,x,b}, {B,c,x,d}};
   NCTest[NCPolynomial`Private`NCSplitMonomials[exp, {x}], answer, test, k++];

   (* NCPolynomial *)

   vars = {x,y};
   p = 0;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<||>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {}, test, k++];
   NCTest[NCPDegree[exp], 0, test, k++];

   p = 1;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[1,<||>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {}, test, k++];
   NCTest[NCPDegree[exp], 0, test, k++];

   p = a + B c;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[a+B c,<||>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {}, test, k++];
   NCTest[NCPDegree[exp], 0, test, k++];

   p = x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{0,1}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = x+a;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[a,<|{x}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = x+y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{1,1,1}},{y}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{0,1}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = x+a**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{1,1,1},{1,a,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = x**y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x**y}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y**x}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = x**y+y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x**y}->{{1,1,1}}, {y**x}->{{1,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1},{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = y**a**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y,x}->{{1,1,a,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = x**y**a+a**y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y**x}->{{1,a,1}}, {x**y}->{{1,1,a}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1},{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = a**x**b+c+d**x**e+a**x**e**x**b;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[c,
                         <|{x}->{{1,a,b},{1,d,e}},
                           {x,x}->{{1,a,e,b}}|>, 
                         vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{2,0}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = a**x**b+c+d**x**e+a**x**e**x**b+a**x**y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[c,
                         <|{x}->{{1,a,b},{1,d,e}},
                           {x**y}->{{1,a,1}},
                           {x,x}->{{1,a,e,b}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{1,1},{2,0}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];
   NCTest[NCPDecompose[answer], 
          <|{1,0}->a**x**b + d**x**e,
	    {1,1}->a**x**y,
	    {2,0}->a**x**e**x**b,
	    {0,0}->c|>,
          test, k++];

   p = A x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{A,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = B y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y}->{{B,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{0,1}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = A x + B a;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[B a,<|{x}->{{A,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = A x + B y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{A,1,1}},{y}->{{B,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{0,1}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = A x + B a**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x}->{{A,1,1},{B,a,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], True, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0}}, test, k++];
   NCTest[NCPDegree[exp], 1, test, k++];

   p = A x**y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x**y}->{{A,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = B y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y**x}->{{B,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = A x**y + B y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x**y}->{{A,1,1}}, {y**x}->{{B,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1},{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = A x**y + B y**x**y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{x**y}->{{A,1,1}}, {y**x**y}->{{B,1,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], False, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1},{1,2}}, test, k++];
   NCTest[NCPDegree[exp], 3, test, k++];

   p = A y**a**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y,x}->{{A,1,a,1}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = A x**y**a + B a**y**x;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[0,<|{y**x}->{{B,a,1}}, {x**y}->{{A,1,a}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,1},{1,1}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];
   NCTest[NCPDecompose[answer], 
          <|{1,1}->A x**y**a + B a**y**x|>,
          test, k++];


   p = A a**x**b + B c + C d**x**e + A B a**x**e**x**b;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[B c,
                         <|{x}->{{A,a,b},{C,d,e}},
                           {x,x}->{{A B,a,e,b}}|>, 
                         vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{2,0}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   p = A a**x**b + B c + C d**x**e + A B a**x**e**x**b + A C a**x**y;
   exp = NCToNCPolynomial[p, vars];
   answer = NCPolynomial[B c,
                         <|{x}->{{A,a,b},{C,d,e}},
                           {x**y}->{{A C,a,1}},
                           {x,x}->{{A B,a,e,b}}|>, vars];
   NCTest[exp, answer, test, k++];
   NCTest[NCPolynomialToNC[exp], p, test, k++];
   NCTest[NCPLinearQ[exp], False, test, k++];
   NCTest[NCPQuadraticQ[exp], True, test, k++];
   NCTest[NCPMonomialDegree[exp], {{1,0},{1,1},{2,0}}, test, k++];
   NCTest[NCPDegree[exp], 2, test, k++];

   NCTest[NCPTermsOfDegree[exp, {1,0}], <|{x}->{{A,a,b},{C,d,e}}|>];
   NCTest[NCPTermsOfDegree[exp, {1,1}], <|{x**y}->{{A C,a,1}}|>];
   NCTest[NCPTermsOfDegree[exp, {2,0}], <|{x,x}->{{A B,a,e,b}}|>];
   NCTest[NCPTermsOfDegree[exp, {2,2}], <||>];
   NCTest[NCPTermsOfDegree[exp, {0,0}], <|{}->{{B c}}|>];

   NCTest[NCPTermsToNC[NCPTermsOfDegree[exp, {1,0}]], A a**x**b + C d**x**e];
   NCTest[NCPTermsToNC[NCPTermsOfDegree[exp, {1,1}]], A C a**x**y];
   NCTest[NCPTermsToNC[NCPTermsOfDegree[exp, {2,0}]], A B a**x**e**x**b]; 
   NCTest[NCPTermsToNC[NCPTermsOfDegree[exp, {2,2}]], 0]; 
   NCTest[NCPTermsToNC[NCPTermsOfDegree[exp, {0,0}]], B c]; 

   NCTest[NCPTermsOfTotalDegree[exp, 1], <|{x}->{{A,a,b},{C,d,e}}|>]; 
   NCTest[NCPTermsOfTotalDegree[exp, 2], <|{x**y}->{{A C,a,1}},
                                          {x,x}->{{A B,a,e,b}}|>];
   NCTest[NCPTermsOfTotalDegree[exp, 3], <||>];
   NCTest[NCPTermsOfTotalDegree[exp, 0], <|{}->{{B c}}|>];

   p = x**inv[z];
   exp = NCToNCPolynomial[p, vars];
   NCTest[exp, NCPolynomial[0,<|{x}->{{1,1,inv[z]}}|>, vars], test, k++];

   Quiet[

     (* NotPolynomial *)
     p = x**inv[y];
     exp = NCToNCPolynomial[p, vars];
     NCTest[exp, $Failed, test, k++];

     p = x**inv[y];
     exp = NCToNCPolynomial[p, vars];
     NCTest[exp, $Failed, test, k++];

     p = x**inv[1 + y];
     exp = NCToNCPolynomial[p, vars];
     NCTest[exp, $Failed, test, k++];

     ,
     NCPolynomial::NotPolynomial
   ];

];
